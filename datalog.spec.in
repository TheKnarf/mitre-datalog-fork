Name:		@PACKAGE@
Version:	@VERSION@
Release:	3%{?dist}

Source0:	http://downloads.sf.net/datalog/%{name}-%{version}.tar.gz

URL:		http://sf.net/projects/datalog
Packager:	The MITRE Corporation
BuildRoot:	%{_tmppath}/%{name}-%{version}-%{release}-root

Summary:	A Lightweight Deductive Database using Datalog
License:	LGPLv2+
Group:		Applications/Databases

BuildRequires:	texinfo, lua-devel == 5.1.4

%define	luapkgdir %{_datadir}/lua/5.1

%description

This package contains a lightweight deductive database system.
Queries and database updates are expressed using Datalog--a
declarative logic language in which each formula is a function-free
Horn clause, and every variable in the head of a clause must appear in
the body of the clause.  The use of Datalog syntax and an
implementation based on tabling intermediate results, ensures that all
queries terminate.

The components in this package are designed to be small, and usable on
memory constrained devices.  The package includes an interactive
interpreter for Datalog.  A library that can be used to embed the
interpreter into C programs is available in the source distribution.

%prep
%setup -q

%build
%configure --with-lua
make %{?_smp_mflags}

%install
rm -rf %{buildroot}
make DESTDIR=%{buildroot} install
/bin/mkdir -p %{buildroot}%{luapkgdir}
/usr/bin/install %{name}.lua %{buildroot}%{luapkgdir}
/bin/rm -rf %{buildroot}/%{_includedir}
/bin/rm -rf %{buildroot}/%{_libdir}
/bin/rm -rf %{buildroot}/%{_datadir}/%{name}
/bin/rm -rf %{buildroot}/%{_infodir}/dir

%clean
rm -rf %{buildroot}

%post
if [ -f %{_infodir}/%{name}.info.gz ]; then
  /sbin/install-info %{_infodir}/%{name}.info.gz %{_infodir}/dir || :
fi

%postun
if [ $1 -eq 0 ]; then
  if [ -f %{_infodir}/%{name}.info.gz ]; then
    /sbin/install-info --delete %{_infodir}/%{name}.info.gz %{_infodir}/dir || :
  fi
fi

%files
%defattr (-, root, root, -)
%doc %{name}.html ChangeLog README COPYING.LIB
%{_bindir}/%{name}
%{_infodir}/%{name}.info.gz
%{luapkgdir}/%{name}.lua

%changelog
* Tue Sep 27 2011 John D. Ramsdell <ramsdell@mitre.org> - 1.6-3
- Use installed Lua package

* Tue Sep 20 2011 John D. Ramsdell <ramsdell@mitre.org> - 1.6-2
- Removed devel package

* Sat Aug 6 2011 John D. Ramsdell <ramsdell@mitre.org> - 1.6-1
- Fixed license name by adding version number
- Dropped vendor field
- Switched to standard name for build root
- %%defaddrs now contain four fields
- Removed asterisks in %%files
- Added COPYING.LIB

* Tue Jul 7 2011 John D. Ramsdell <ramsdell@mitre.org> - 1.4-1
- Initial spec release
