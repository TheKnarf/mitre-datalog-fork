<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Datalog.js</title>
<script type="text/js-worker" src="datalog-2.2/datalog.js"></script>
<script type="text/js-worker">
var queryableFunctions = {
  runDatalog: function(clauses, lua, queries) {
      var wrapperPreInit = function(FS) {
          FS.createDataFile('/', 'datalog.dl', clauses, true, false);
          FS.createDataFile('/', 'queries.dl', queries, true, false);
          FS.createDataFile('/', 'lib.lua', lua, true, false);
      };

      var Module = {};
      Module["arguments"] = ['-i', '-l', '/lib.lua', '/datalog.dl', '/queries.dl'];
      Module["print"] = function(v) { reply("print", v); };
      Module["noInitialRun"] = true;
      Module = CompiledModule(Module,wrapperPreInit);
      var rc = Module["run"]();
      reply("runFinished", rc);
  }
};
 
function defaultQuery (vMsg) {
  // default PUBLIC function executed only when main page calls the queryableWorker.postMessage() method directly
}
 
function reply (/* listener name, argument to pass 1, argument to pass 2, etc. etc */) {
  if (arguments.length < 1) { throw new TypeError("reply - not enough arguments"); return; }
  postMessage({ "vo42t30": arguments[0], "rnb93qh": Array.prototype.slice.call(arguments, 1) });
}
 
self.onmessage = function (oEvent) {
  if (oEvent.data instanceof Object && oEvent.data.hasOwnProperty("bk4e1h0") && oEvent.data.hasOwnProperty("ktp3fm1")) {
    queryableFunctions[oEvent.data.bk4e1h0].apply(self, oEvent.data.ktp3fm1);
  } else {
    defaultQuery(oEvent.data);
  }
};
</script>
  <link type="text/css" rel="stylesheet" href="normalize.css">
  <script src="css_browser_selector_dev.js"></script>

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.8.1/jquery.min.js"></script>
  <script src="tablesorter/js/jquery.tablesorter.min.js"></script>
  <script src="tablesorter/js/jquery.tablesorter.widgets.min.js"></script>
  <link type="text/css" href="tablesorter/css/datalog/style.css" rel="stylesheet">
  <script src="prefixfree.min.js"></script>
  <script src="prefixfree.jquery.js"></script>
  <script src="jquery.qtip.min.js"></script>
  <link type="text/css" rel="stylesheet" href="jquery.qtip.css">

  <link type="text/css" rel="stylesheet" href="CodeMirror-2.33/lib/codemirror.css">
  <script type="text/javascript" src="CodeMirror-2.33/lib/codemirror.js"></script>
  <script type="text/javascript" src="datalogCodeMirrorMode.js"></script>
  <script type="text/javascript" src="CodeMirror-2.33/mode/lua/lua.js"></script>
  <link rel="stylesheet" href="CodeMirror-2.33/theme/neat.css">
  <link rel="stylesheet" href="CodeMirror-2.33/theme/elegant.css">
  <link rel="stylesheet" href="CodeMirror-2.33/theme/erlang-dark.css">
  <link rel="stylesheet" href="CodeMirror-2.33/theme/night.css">
  <link rel="stylesheet" href="CodeMirror-2.33/theme/monokai.css">
  <link rel="stylesheet" href="CodeMirror-2.33/theme/cobalt.css">
  <link rel="stylesheet" href="CodeMirror-2.33/theme/eclipse.css">
  <link rel="stylesheet" href="CodeMirror-2.33/theme/rubyblue.css">
  <link rel="stylesheet" href="CodeMirror-2.33/theme/lesser-dark.css">
  <link rel="stylesheet" href="CodeMirror-2.33/theme/xq-dark.css">
  <link rel="stylesheet" href="CodeMirror-2.33/theme/ambiance.css">
  <link rel="stylesheet" href="CodeMirror-2.33/theme/blackboard.css">
  <link rel="stylesheet" href="CodeMirror-2.33/theme/vibrant-ink.css">
  <script src="CodeMirror-2.33/lib/util/simple-hint.js"></script>
  <link rel="stylesheet" href="CodeMirror-2.33/lib/util/simple-hint.css">
  <script src="datalog-hint.js"></script>
<script src="es6-shim/es6-shim.js"></script>
<script>/*the only js is to continuously checking the value of the dropdown. for posterity*/
//var j = {"datalogchange": 1, "luachange": 1, "querychange": 1};

//var i = setInterval(function(){$("#trace").val($("input[name=line-style]:checked").val());},100);

window["editorOnChange"] = function(editor, change, nameToBox) {
/*
        console.log(arguments);
        var editor = arguments[0], change = arguments[1];
        var type;
        if (change["text"])
          type="deletion";
        else
          type="addition";
        var boxToClass = new Map();
        boxToClass.set(nameToBox["datalog"], "datalogchange");
        boxToClass.set(nameToBox["lua"], "luachange");
        boxToClass.set(nameToBox["query"], "querychange");

        var cl = boxToClass.get(editor);
        var id = cl + "-" + j[cl];
        $("#image-dropdown").append(
          $("<input type='radio' id='"+id+"' name='line-style-" + cl + "' value='"+j[cl]+"' " + (j[cl] !== 1 ? "" : "checked") + " />")
        ).append(
          $("<label for='" + id + "'>").addClass(cl).addClass(type).append(
            $("<div class='changedcontent'>").append(change["text"] ? change.text : "no text available")
          ).append(
            $("<div class='time'>").append(new Date().toString())
          )
        );
        j[cl]++;
*/
};
</script>

  <script src="wrapper.js"></script>
  <link type="text/css" rel="stylesheet" href="wrapper.css">
<!--
<style>
/*o.v.*/

#image-dropdown {
    /*style the "box" in its minimzed state*/
    border:1px solid #999; width:300px; height:75px; overflow:hidden;
    /*animate collapsing the dropdown from open to closed state (v. fast)*/
    -moz-transition: height 0.1s; 
    -webkit-transition: height 0.1s; 
    -ms-transition: height 0.1s;  
    -o-transition: height 0.1s;  
    transition: height 0.1s;
    background-color: #fff;
}
#image-dropdown:hover {
    /*when expanded, the dropdown will get native means of scrolling*/
    height:600px; overflow-y:scroll;
    /*nice and smooth expand - speed this up at your preference or remove animation altogether*/
    -moz-transition: height 0.5s; 
    -webkit-transition: height 0.5s; 
    -ms-transition: height 0.5s;  
    -o-transition: height 0.5s;  
    transition: height 0.5s;
}
#image-dropdown input {
    /*hide the nasty default radio buttons. like, completely!*/
    position:absolute;top:0;left:0;opacity:0;
}


#image-dropdown label {
    color: black;
    overflow:hidden;
    /*style the labels to look like dropdown options, kinda*/
    display:none; margin:2px; height:46px;
    border-left: 0.2em solid transparent;
    font-size: 0.8em; 
    text-overflow: ellipsis;
    text-wrap: none;
    white-space: nowrap;
    font-weight: lighter;
    
}
#image-dropdown label.addition::before {
    content: 'Addition';
}
#image-dropdown label.datalogchange {
    border-left: 0.2em solid red;
}
#image-dropdown label.luachange {
    border-left: 0.2em solid green;
}
#image-dropdown label.querychange {
    border-left: 0.2em solid blue;
}
#image-dropdown:hover label{
    /*this is how labels render in the "expanded" state. we want to see only the selected radio button in the collapsed menu, and all of them when expanded*/
    display:block;
}
#image-dropdown label:hover {
    opacity:0.75;
}
#image-dropdown input:checked + label {
    /*tricky! labels immediately following a checked radio button (with our markup they are semantically related) should be fully opaque regardless of hover, and they should always be visible (i.e. even in the collapsed menu*/
    opacity: 1 !important; font-weight:bold !important; display:block;
}

/*pfft, nothing as cool here, just the value trace
#trace {margin:0 0 20px;}*/

#historycontainer { position:absolute; top:0em; left: 65%; z-index: 100; }
.header.row { overflow:visible; }
</style>
-->
</head>
<body>
  <div class="header row">
<!--
    <div id="historycontainer">
<input type="text" value="" id="trace"/>
<div id="image-dropdown" >
</div>
    </div>
-->
    <div id="selectdiv">
    <label for="select">Theme:</label>
    <select id="select">
    <option>ambiance</option>
    <option>blackboard</option>
    <option>cobalt</option>
    <option>eclipse</option>
    <option selected>elegant</option>
    <option>erlang-dark</option>
    <option>lesser-dark</option>
    <option>monokai</option>
    <option>neat</option>
    <option>night</option>
    <option>rubyblue</option>
    <option>vibrant-ink</option>
    <option>xq-dark</option>
    </select>
    </div>
    <div><h2>Datalog.js</h2> (not affiliated with, but using <a href="http://datalog.sourceforge.net/">MITRE lightweight Datalog</a>)</div>
    Examples (click to overwrite and execute):
    <ul id="examples">
    </ul>
  </div> 
  <form id="codeform" action="#" method="get" onsubmit="javascript:return false;">
  <div class="body row scroll-y">
    <div class="pane" id="outputpane">
<!--      <div class="fline">Output:</div>-->
      <div class="tabcontainer taboneactive" id="outputtabcontainer">
        <ul class="tabs">
          <li class="tnl t1l"><a href="javascript:tab('t1','#outputtabcontainer');">output as Datalog</a></li>
          <li class="tnl t2l"><a href="javascript:tab('t2','#outputtabcontainer');">output as tables</a></li>
        </ul>
        <div class="t1">
          <div class="outputtab">
            <pre id="output">
            Loading...
            </pre>
          </div>
        </div>
        <div class="t2">
          <div class="outputtab">
            <div id="tableoutput">
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="pane" id="datalogpane">
      <div class="fline"><label for="datalog">Datalog program:</label></div>
      <textarea id="datalog"></textarea>
    </div>
    <div class="pane" id="luapane">
      <div class="tabcontainer taboneactive" id="tabcontainer">
        <ul class="tabs">
          <li class="tnl t1l"><label for="lua"><a href="javascript:tab('t1','#tabcontainer');">Lua</a></label></li>
          <li class="tnl t2l"><label for="queries"><a href="javascript:tab('t2','#tabcontainer');">Datalog queries</a></label></li>
        </ul>
        <div class="t1">
          <textarea id="lua"></textarea>
        </div>
        <div class="t2">
          <textarea id="queries"></textarea>
        </div>
      </div>
    </div>
  </div> 
  <div class="footer row">
    <div id="footerpane" class="pane">
      <input id="submitbutton" class="button" type="submit" disabled value="Execute">
    </div>
  </div>
  </form>
</body>
</html>
